{"is_source_file": true, "format": "Python", "description": "This file defines a WatcherAgent class responsible for retrieving YouTube video transcripts, either via an official API or by downloading audio and placeholder transcription. It includes methods for URL normalization, video ID extraction, and fallback mechanisms for audio download.", "external_files": ["youtube_transcript_api", "yt_dlp", "pytube"], "external_methods": ["YouTubeTranscriptApi.get_transcript", "yt_dlp.YoutubeDL", "PyTubeYouTube.streams.filter"], "published": ["WatcherResult", "WatcherAgent"], "classes": [{"name": "WatcherResult", "description": "Dataclass holding the result of a YouTube transcript fetch, including success status, transcript text, and error details."}, {"name": "WatcherAgent", "description": "Main class orchestrating the process of retrieving transcripts from YouTube videos, with fallback mechanisms."}], "methods": [{"name": "WatcherResult get_transcript(self, youtube_url: str)", "description": "Main method to retrieve the transcript of a YouTube video given its URL. Attempts API fetch first, then audio download if API fails.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _normalize_url(self, url: str)", "description": "Normalizes YouTube URLs to a standard format, removing playlist and radio parameters.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "Optional[str] _extract_video_id(self, url: str)", "description": "Extracts the YouTube video ID from various URL formats.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "Optional[str] _try_youtube_transcript_api(self, video_id: str)", "description": "Tries to fetch transcripts via youtube_transcript_api for a given video ID.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "Tuple[Optional[str],Optional[str]] _try_download_audio(self, youtube_url: str, video_id: Optional[str])", "description": "Attempts to download the video's audio using yt_dlp or pytube as fallback.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "None _safe_remove(self, path: Optional[str])", "description": "Removes temporary audio files if they exist.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _clean_text(self, text: str)", "description": "Cleans transcript text by removing bracketed notes and extra whitespace.", "scope": "WatcherAgent", "scopeKind": "class"}], "calls": ["YouTubeTranscriptApi.get_transcript", "yt_dlp.YoutubeDL", "PyTubeYouTube.streams.filter"], "search-terms": ["YouTube transcript retrieval", "URL normalization", "video ID extraction", "audio fallback download", "transcript API", "yt_dlp", "pytube"], "state": 2, "file_id": 20, "knowledge_revision": 55, "git_revision": "1daea3777d9a4ac77b3108e130cf7c15c2eb3f73", "revision_history": [{"41": ""}, {"55": "1daea3777d9a4ac77b3108e130cf7c15c2eb3f73"}], "ctags": [{"_type": "tag", "name": "NoTranscriptFound", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    NoTranscriptFound = Exception  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PyTubeYouTube", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    PyTubeYouTube = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PyTubeYouTube", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    from pytube import YouTube as PyTubeYouTube  # For fallback audio download$/", "language": "Python", "kind": "unknown", "nameref": "unknown:YouTube"}, {"_type": "tag", "name": "TranscriptsDisabled", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    TranscriptsDisabled = Exception  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "WatcherAgent", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^class WatcherAgent:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "WatcherResult", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^class WatcherResult:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "YT_ID_PATTERN", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    YT_ID_PATTERN = re.compile(r\"(?:v=|\\/)([0-9A-Za-z_-]{11}).*\")$/", "language": "Python", "kind": "variable", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "YouTubeTranscriptApi", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    YouTubeTranscriptApi = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_clean_text", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _clean_text(self, text: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, text: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_extract_video_id", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _extract_video_id(self, url: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "member", "signature": "(self, url: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_normalize_url", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _normalize_url(self, url: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, url: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_safe_remove", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _safe_remove(self, path: Optional[str]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, path: Optional[str])", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_try_download_audio", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _try_download_audio(self, youtube_url: str, video_id: Optional[str]) -> Tuple[Optional[s/", "language": "Python", "typeref": "typename:Tuple[Optional[str],Optional[str]]", "kind": "member", "signature": "(self, youtube_url: str, video_id: Optional[str])", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_try_youtube_transcript_api", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _try_youtube_transcript_api(self, video_id: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "member", "signature": "(self, video_id: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "details", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    details: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WatcherResult", "scopeKind": "class"}, {"_type": "tag", "name": "error", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    error: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WatcherResult", "scopeKind": "class"}, {"_type": "tag", "name": "get_transcript", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def get_transcript(self, youtube_url: str) -> WatcherResult:$/", "language": "Python", "typeref": "typename:WatcherResult", "kind": "member", "signature": "(self, youtube_url: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "transcript", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    transcript: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WatcherResult", "scopeKind": "class"}, {"_type": "tag", "name": "yt_dlp", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    yt_dlp = None  # type: ignore$/", "language": "Python", "kind": "variable"}], "hash": "55e1fd1cba62561609b243a5146cbd8b", "format-version": 4, "code-base-name": "python_console_app", "filename": "python_console_app/api/agents/watcher_agent.py", "fields": [{"name": "NoTranscriptFound = Exception  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "PyTubeYouTube = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "TranscriptsDisabled = Exception  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "YT_ID_PATTERN = re.compile(r\"(?:v=|\\/)([0-9A-Za-z_-]{11}).*\")", "scope": "WatcherAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "YouTubeTranscriptApi = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] details", "scope": "WatcherResult", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] error", "scope": "WatcherResult", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] transcript", "scope": "WatcherResult", "scopeKind": "class", "description": "unavailable"}, {"name": "yt_dlp = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}]}