{"is_source_file": true, "format": "Python", "description": "This Python source file defines a `WatcherAgent` class responsible for extracting a textual description from a PDF file using multiple backend strategies. It includes robustness fallbacks such as `PyPDF2`, `pdfplumber`, `PyMuPDF`/`fitz`, and OCR (via `pytesseract`) to handle various PDF formats and potential malformations. The class provides a high-level interface `get_description_from_pdf` that attempts text extraction through multiple methods, applies heuristics to isolate a 'Description' section or the first substantial paragraph, and handles errors with guidance messages.", "external_files": ["PyPDF2", "pdfplumber", "fitz", "pytesseract", "PIL.Image"], "external_methods": ["PyPDF2.PdfReader", "pdfplumber.open", "fitz.open", "fitz.Matrix", "fitz.Page.get_pixmap", "Image.open", "pytesseract.image_to_string"], "published": ["WatcherResult", "WatcherAgent"], "classes": [{"name": "WatcherResult", "description": "Data class that holds the outcome of PDF text extraction, including success flag, description text, and error or detail messages."}, {"name": "WatcherAgent", "description": "Main class responsible for robustly extracting a description paragraph from a PDF file, using multiple backend strategies and heuristics."}], "methods": [{"name": "WatcherResult get_description_from_pdf(self, pdf_path: str)", "description": "Public method that takes a PDF file path, attempts to extract descriptive text via multiple backends, applies heuristics to find the description block, and returns a `WatcherResult` indicating success or failure with details.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _extract_text_with_pypdf2(self, path: str)", "description": "Helper method to extract text from a PDF using `PyPDF2`, processing up to the first five pages.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _extract_text_with_pdfplumber(self, path: str)", "description": "Helper method to extract text using `pdfplumber`, processing up to five pages.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _extract_text_with_pymupdf(self, path: str)", "description": "Helper method to extract text using `fitz` (PyMuPDF), processing up to five pages.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _extract_text_with_ocr(self, path: str, max_pages: int = 3)", "description": "Performs OCR on the first few pages (up to 3) by rendering pages as images via `fitz` and processing with `pytesseract`.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _pick_best_text(self, candidates: List[str])", "description": "Selects the most suitable text among candidates based on length heuristic.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _normalize_whitespace(self, raw: str)", "description": "Cleans and normalizes whitespace in extracted text for better processing.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _find_description_block(self, text: str)", "description": "Heuristically searches for a 'Description' section or picks the first large paragraph from the text.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "bool _looks_like_heading(self, line: str)", "description": "Helper to identify lines that likely are headings based on formatting and length.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _normalize_paragraphs(self, lines: List[str])", "description": "Joins lines into paragraphs with proper spacing.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _build_guidance_message(self, errors: List[str])", "description": "Constructs an actionable guidance message from errors and hints for resolving issues.", "scope": "WatcherAgent", "scopeKind": "class"}], "calls": ["PyPDF2.PdfReader", "pdfplumber.open", "fitz.open", "fitz.Page.get_text", "fitz.Page.get_pixmap", "Image.open", "pytesseract.image_to_string"], "search-terms": ["PDF text extraction", "robust PDF parser", "OCR PDF", "PyPDF2", "pdfplumber", "fitz", "PyMuPDF", "pytesseract", "PDF description extraction", "fallback PDF processing"], "state": 2, "file_id": 20, "knowledge_revision": 70, "git_revision": "21d65df6feda450baec1d09ba09dca5ca0aca35a", "revision_history": [{"41": ""}, {"55": "1daea3777d9a4ac77b3108e130cf7c15c2eb3f73"}, {"57": "e96b276f7abdd72f801c7fd0352e9f4789153ba7"}, {"64": "9454c6751dc15463fc95698e521fb7cff159a133"}, {"69": "21d65df6feda450baec1d09ba09dca5ca0aca35a"}, {"70": "21d65df6feda450baec1d09ba09dca5ca0aca35a"}], "ctags": [{"_type": "tag", "name": "Image", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    Image = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PyPDF2", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    PyPDF2 = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "WatcherAgent", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^class WatcherAgent:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "WatcherResult", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^class WatcherResult:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_build_guidance_message", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _build_guidance_message(self, errors: List[str]) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, errors: List[str])", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_extract_text_with_ocr", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _extract_text_with_ocr(self, path: str, max_pages: int = 3) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, path: str, max_pages: int = 3)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_extract_text_with_pdfplumber", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _extract_text_with_pdfplumber(self, path: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, path: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_extract_text_with_pymupdf", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _extract_text_with_pymupdf(self, path: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, path: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_extract_text_with_pypdf2", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _extract_text_with_pypdf2(self, path: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, path: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_find_description_block", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _find_description_block(self, text: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, text: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_looks_like_heading", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _looks_like_heading(self, line: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "member", "signature": "(self, line: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_normalize_paragraphs", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _normalize_paragraphs(self, lines: List[str]) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, lines: List[str])", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_normalize_whitespace", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _normalize_whitespace(self, raw: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, raw: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_pick_best_text", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _pick_best_text(self, candidates: List[str]) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, candidates: List[str])", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    description: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WatcherResult", "scopeKind": "class"}, {"_type": "tag", "name": "details", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    details: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WatcherResult", "scopeKind": "class"}, {"_type": "tag", "name": "error", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    error: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WatcherResult", "scopeKind": "class"}, {"_type": "tag", "name": "fitz", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    fitz = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "get_description_from_pdf", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def get_description_from_pdf(self, pdf_path: str) -> WatcherResult:$/", "language": "Python", "typeref": "typename:WatcherResult", "kind": "member", "signature": "(self, pdf_path: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "pdfplumber", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    pdfplumber = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "pytesseract", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    pytesseract = None  # type: ignore$/", "language": "Python", "kind": "variable"}], "hash": "afd0440acc1f912ab52232670b845b3c", "format-version": 4, "code-base-name": "python_console_app", "filename": "python_console_app/api/agents/watcher_agent.py", "fields": [{"name": "Image = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "PyPDF2 = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] description", "scope": "WatcherResult", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] details", "scope": "WatcherResult", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] error", "scope": "WatcherResult", "scopeKind": "class", "description": "unavailable"}, {"name": "fitz = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "pdfplumber = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "pytesseract = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}]}