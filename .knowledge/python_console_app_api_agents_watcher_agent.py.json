{"is_source_file": true, "format": "Python", "description": "This Python source file defines a WatcherAgent class responsible for fetching YouTube video transcripts using youtube_transcript_api, and, if unavailable, attempting to download the audio via pytube as a fallback. It includes methods to parse video IDs from URLs, clean transcript text, and handle fallback scenarios with appropriate error messages. It is part of a system aimed at retrieving or preparing to transcribe YouTube video content.", "external_files": ["youtube_transcript_api", "pytube"], "external_methods": ["YouTubeTranscriptApi.get_transcript", "pytube.YouTube.streams.filter", "os.path.exists", "os.remove"], "published": ["WatcherAgent", "WatcherResult"], "classes": [{"name": "WatcherResult", "description": "Dataclass holding the result status, transcript, error, and additional details of attempting to fetch a transcript."}], "methods": [{"name": "WatcherResult get_transcript(self, youtube_url: str)", "description": "Main public method to retrieve the transcript for a given YouTube URL, handling various fallback scenarios and returning a WatcherResult.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "Optional[str] _extract_video_id(self, url: str)", "description": "Extracts the YouTube video ID from various URL formats.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "Optional[str] _try_youtube_transcript_api(self, video_id: str)", "description": "Attempts to fetch the transcript via youtube_transcript_api, returns cleaned transcript text or None.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "Tuple[Optional[str],Optional[str]] _try_download_audio(self, youtube_url: str)", "description": "Attempts to download the video's audio stream via pytube; returns file path or error message.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "None _safe_remove(self, path: Optional[str])", "description": "Removes temporary files safely if they exist.", "scope": "WatcherAgent", "scopeKind": "class"}, {"name": "str _clean_text(self, text: str)", "description": "Cleans transcript text by removing bracketed annotations and extra whitespace.", "scope": "WatcherAgent", "scopeKind": "class"}], "calls": ["YouTubeTranscriptApi.get_transcript", "pytube.YouTube", "os.path.exists", "os.remove"], "search-terms": ["YouTubeTranscriptApi", "pytube", "watcher agent", "transcript retrieval", "video ID extraction"], "state": 2, "file_id": 20, "knowledge_revision": 41, "git_revision": "", "ctags": [{"_type": "tag", "name": "NoTranscriptFound", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    NoTranscriptFound = Exception  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "TranscriptsDisabled", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    TranscriptsDisabled = Exception  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "WatcherAgent", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^class WatcherAgent:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "WatcherResult", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^class WatcherResult:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "YT_ID_PATTERN", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    YT_ID_PATTERN = re.compile($/", "language": "Python", "kind": "variable", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "YouTube", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    YouTube = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "YouTubeTranscriptApi", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    YouTubeTranscriptApi = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_clean_text", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _clean_text(self, text: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, text: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_extract_video_id", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _extract_video_id(self, url: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "member", "signature": "(self, url: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_safe_remove", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _safe_remove(self, path: Optional[str]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, path: Optional[str])", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_try_download_audio", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _try_download_audio(self, youtube_url: str) -> Tuple[Optional[str], Optional[str]]:$/", "language": "Python", "typeref": "typename:Tuple[Optional[str],Optional[str]]", "kind": "member", "signature": "(self, youtube_url: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_try_youtube_transcript_api", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def _try_youtube_transcript_api(self, video_id: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "member", "signature": "(self, video_id: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "details", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    details: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WatcherResult", "scopeKind": "class"}, {"_type": "tag", "name": "error", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    error: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WatcherResult", "scopeKind": "class"}, {"_type": "tag", "name": "get_transcript", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    def get_transcript(self, youtube_url: str) -> WatcherResult:$/", "language": "Python", "typeref": "typename:WatcherResult", "kind": "member", "signature": "(self, youtube_url: str)", "scope": "WatcherAgent", "scopeKind": "class"}, {"_type": "tag", "name": "transcript", "path": "/home/kavia/workspace/code-generation/youtube-lyrics-generator-2745-2754/python_console_app/api/agents/watcher_agent.py", "pattern": "/^    transcript: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "WatcherResult", "scopeKind": "class"}], "hash": "d67821aafb4a0f881c9bb204a56911d5", "format-version": 4, "code-base-name": "python_console_app", "filename": "python_console_app/api/agents/watcher_agent.py", "fields": [{"name": "NoTranscriptFound = Exception  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "TranscriptsDisabled = Exception  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "YT_ID_PATTERN = re.compile(", "scope": "WatcherAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "YouTube = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "YouTubeTranscriptApi = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] details", "scope": "WatcherResult", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] error", "scope": "WatcherResult", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] transcript", "scope": "WatcherResult", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"41": ""}]}